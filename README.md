# DB2WHMONITORING

### SORTHEAP Overflows

SELECT
  SUM(TOTAL_HASH_JOINS) as T_HSHJOINS,
  SUM(TOTAL_SORTS) as T_SORTS,
  SUM(SORT_OVERFLOWS) as T_SORT_OVERFLOWS,
  SUM(TOTAL_HASH_GRPBYS) as T_HSH_GROUPBYS,
  SUM(HASH_GRPBY_OVERFLOWS) as T_GBY_OVERFLOWS,
  SUM(TOTAL_OLAP_FUNCS) as T_OLAP_FUNCS,
  SUM(OLAP_FUNC_OVERFLOWS) as T_OLAP_FUNC_OVERFLOWS
FROM TABLE(MON_GET_PKG_CACHE_STMT(NULL, NULL, NULL, -1))
WITH UR;

### Post threshold operations

SELECT
  SUM(POST_THRESHOLD_SORTS) as PT_SORTS,
  SUM(POST_SHRTHRESHOLD_SORTS) as PT_SORT_THRESH,
  SUM(POST_THRESHOLD_HASH_GRPBYS) as PT_GBYS,
  SUM(POST_THRESHOLD_HASH_JOINS) as PT_HJ
FROM TABLE(MON_GET_PKG_CACHE_STMT(NULL, NULL, NULL, -1))
WITH UR;

### SORTHEAP HWM

SELECT
  MAX(SORT_SHRHEAP_TOP) as T_SHRHEAP_TOP,
  MAX(SORT_CONSUMER_SHRHEAP_TOP) as T_CSHEAP_TOP
FROM TABLE(MON_GET_PKG_CACHE_STMT(NULL, NULL, NULL, -1))
WITH UR;

### Basic bufferpool statistics

SELECT
  SUM(POOL_COL_L_READS) as T_LREADS,
  SUM(POOL_COL_P_READS) as T_PREADS,
  SUM(POOL_TEMP_COL_L_READS) as T_TMP_LREADS,
  SUM(POOL_TEMP_COL_P_READS) as T_TMP_PREADS
FROM TABLE(MON_GET_PKG_CACHE_STMT(NULL, NULL, NULL, -1))
WITH UR;

### Basic Latch Wait statistics

SELECT
  SUBSTR(LATCH_NAME,1,60) AS LATCH_NAME,
  TOTAL_EXTENDED_LATCH_WAITS as TOTAL_LATCH_WAITS,
  TOTAL_EXTENDED_LATCH_WAIT_TIME as TOTAL_WAIT_TIME_MS
FROM TABLE(MON_GET_EXTENDED_LATCH_WAIT(NULL))
ORDER BY TOTAL_LATCH_WAITS DESC
FETCH FIRST 10 ROWS ONLY ;
